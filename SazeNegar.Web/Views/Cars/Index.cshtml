@model List<SazeNegar.Core.Models.Cars>

@{
    Layout = "~/Views/Shared/_Layout.cshtml";
}

@Html.Action("Titlebar", "Cars")

<!-- Content
================================================== -->
<div class="container">
    <div class="row sticky-wrapper">

        <!-- Sidebar -->
        <div class="col-lg-4 col-md-4">
            <div class="sidebar sticky right">

                <!-- Widget -->
                <div class="widget margin-bottom-40">
                    <h3 class="margin-top-0 margin-bottom-35">یافتن خودروی جدید</h3>

                    @*@using (Html.BeginForm("Index", "Cars", FormMethod.Post))
                    {*@

                        <!--Row-->
                        <div class="row with-forms">
                            <!-- Type -->
                            <div class="col-md-12">
                                <select data-placeholder="برند" class="chosen-select-no-single" id="brand">
                                    <option value="0">همه برندها</option>
                                    @foreach (var item in ViewBag.Brands)
                                    {
                                        <option value="@item.Id">@item.Brand</option>
                                    }
                                </select>
                            </div>
                        </div>
                        <!-- Row / End -->
                        <!-- Min Area -->
                        <div class="row with-forms">
                            <div class="col-md-6">
                                <!-- Select Input -->
                                <div class="select-input">
                                    @*<input type="text" placeholder="حداقل قیمت" data-unit="تومان" id="priceFrom">*@
                                    <select class="chosen-select-no-single" data-placeholder="حداقل قیمت" data-unit="تومان" id="priceFrom">
                                        <option></option>
                                        <option value="100000000">100 میلیون</option>
                                        <option value="200000000">200 میلیون</option>
                                        <option value="300000000">300 میلیون</option>
                                        <option value="400000000">400 میلیون</option>
                                        <option value="500000000">500 میلیون</option>
                                    </select>
                                </div>
                                <!-- Select Input / End -->
                            </div>

                            <!-- Max Area -->
                            <div class="col-md-6">
                                <!-- Select Input -->
                                <div class="select-input">
                                    @*<input type="text" placeholder="حداکثر قیمت" data-unit="تومان" id="priceTo">*@
                                    <select class="chosen-select-no-single" data-placeholder="حداکثر قیمت" data-unit="تومان" id="priceTo">
                                        <option></option>
                                        <option value="100000000">100 میلیون</option>
                                        <option value="200000000">200 میلیون</option>
                                        <option value="300000000">300 میلیون</option>
                                        <option value="400000000">400 میلیون</option>
                                        <option value="500000000">500 میلیون</option>
                                    </select>
                                </div>
                                <!-- Select Input / End -->
                            </div>
                        </div>




                        <!-- Row / End -->


                        <br>


                        <!-- More Search Options -->
                        <a href="#" class="more-search-options-trigger margin-bottom-10 margin-top-30"
                           data-open-title="گزینه های بیشتر" data-close-title="بستن"></a>

                        <div class="more-search-options relative">

                            <!-- Checkboxes -->
                            <div class="checkboxes one-in-row margin-bottom-10">

                                <input type="checkbox"
                                       id="check-2"
                                       value="Gear"
                                       name="options">
                                <label for="check-2">دنده اتوماتیک</label>

                                <input type="checkbox"
                                       id="check-3"
                                       value="Sunroof"
                                       name="options">
                                <label for="check-3">سانروف</label>

                                <input type="checkbox"
                                       id="check-4"
                                       value="Doors"
                                       name="options">
                                <label for="check-4">دودر</label>

                                <input type="checkbox"
                                       id="check-5"
                                       value="Navigation"
                                       name="options">
                                <label for="check-5">نویگیشن</label>




                            </div>
                            <!-- Checkboxes / End -->

                        </div>
                        <!-- More Search Options / End -->

                        <button class="button fullwidth margin-top-30" onclick="GetGrid()">جستجو</button>

                      @*}*@


                    <!-- </div> -->
                    <!-- Widget / End -->
                    <!-- Widget -->
                    <div class="widget margin-top-55">
                        <h3 class="margin-bottom-35">خودرو های ویژه</h3>

                        <div class="listing-carousel outer">
                            @foreach (var item in ViewBag.SpecialCars)
                            {
                                <!-- Item -->
                                <div class="item">
                                    <div class="listing-item compact">

                                        <a href="/Cars/singleCar/@item.Id" class="listing-img-container">

                                            <div class="listing-badges">
                                                @if (item.Special != null)
                                                {
                                                    <span class="featured">ویژه</span>
                                                }
                                                @*<span>فروشی</span>*@
                                            </div>

                                            <div class="listing-img-content">
                                                <span class="listing-compact-title">
                                                    @item.Brand.Brand
                                                    <i>
                                                        @item.Price
                                                        تومان
                                                    </i>
                                                </span>

                                                <ul class="listing-hidden-content">
                                                    <li>دنده<span>@item.Gear</span></li>
                                                    <li>نویگشین <span>@item.Navigation</span></li>
                                                    <li>سانروف <span>@item.Sunroof</span></li>
                                                </ul>
                                            </div>

                                            <img src="../../Files/CarsImages/Image/@item.Image" alt="" style="height: 230px">
                                        </a>

                                    </div>
                                </div>
                                <!-- Item / End -->
                            }
                        </div>

                    </div>
                    <!-- Widget / End -->


                </div>
            </div>
        </div>
        <!-- Sidebar / End -->

        <div class="col-lg-8 col-md-8 dir-rtl">

            <h4 class="headline">لیست خودرو ها</h4>

            <!-- Main Search Input -->
            <form method="post" action="/Cars/Index">
                <div class="main-search-input margin-bottom-35">
                    <input type="text" class="ico-01" placeholder="مدل و ... را وارد کنید" value="" name="searchString" id="searchString"/>
                    <button class="button" type="submit">جستجو</button>
                </div>
            </form>

            <!-- Sorting / Layout Switcher -->
            <div class="row margin-bottom-15">

                <div class="col-md-6">
                    <!-- Sort by -->
                    <div class="sort-by">
                        <label>مرتب سازی براساس:</label>

                        <div class="sort-by-select">
                            <select data-placeholder="پیش فرض" class="chosen-select-no-single" id="sort" onchange="GetGrid()">
                                <option value="date">پیش فرض</option>
                                <option value="price-low-to-high">قیمت از کم به زیاد</option>
                                <option value="price-high-to-low">قیمت از زیاد به کم</option>
                                <option value="newest">جدیدترین</option>
                                <option value="oldest">قدیمی ترین</option>
                            </select>
                        </div>
                    </div>
                </div>

                <div class="col-md-6">
                    <!-- Layout Switcher -->
                    <div class="layout-switcher">
                        <a href="#" class="list"><i class="fa fa-th-list"></i></a>
                        <a href="#" class="grid"><i class="fa fa-th-large"></i></a>
                    </div>
                </div>
            </div>

            <!--CAR GRID LIST-->
            <div id="grid"></div>

        </div>

    </div>
</div>

<div class="margin-top-55"></div>

@* ReSharper disable Razor.SectionNotResolved *@
@section scripts
{
    <script>
        function GetGrid(page) {
            ////$("#loading").show();
            var pageNumber = 1;
            if (page != null) {
                pageNumber = page;
            }
            var sort = $("#sort").find(":selected").val();
            var searchString =  '@ViewBag.SearchString';
            //var searchString = $("#searchString").val();
            var brand = null;
            var priceFrom = null;
            var priceTo = null;
            var options = [];

            priceFrom = $("#priceFrom").find(":selected").val();
            priceTo = $("#priceTo").find(":selected").val();
            brand = $("#brand").find(":selected").val();
            console.log("pricefrom: ",priceFrom);
            console.log("searchstring: ",searchString);

            $("input[name='options']").map(function() {
                if ($(this).prop("checked") === true) {
                    options.push($(this).val());
                }
            });

            var grid = {
                searchString: searchString,
                priceFrom: priceFrom,
                priceTo: priceTo,
                brand: brand,
                options: options.join('-'),
                pageNumber: pageNumber,
                sort: sort
            }
            $.ajax({
                type: 'GET',
                url: '/CarListGrid',
                data: grid,
                success: function(data) {
                    $("#grid").html(data);
                    console.log("success");
                    console.log(data);
                },
                error: function(data) {
                    console.log("error");
                    console.log(data);
                },
                complete: function() {
                    console.log("complete");
                }
            });
        }

        $(document).ready(function () {
            GetGrid();
        });

    </script>

}
